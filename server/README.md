Golang Web Calculator Service
Golang Web Calculator Service — это распределённое веб-приложение на Go, которое позволяет вычислять математические выражения по HTTP-запросу. Проект состоит из двух основных компонентов:

Оркестратор (Orchestrator)
Принимает запросы от клиента, распределяет задачи между агентами, собирает результаты вычислений и возвращает их обратно.

Агент (Agent)
Получает задачу от оркестратора, производит вычисление математического выражения и отправляет результат обратно оркестратору.

Возможности
Вычисление математических выражений (например, 2+2*2, 10 / 5, 100 * 100 * 20123123123 , ...).
Поддержка горизонтального масштабирования за счёт запуска нескольких экземпляров агента.
Простое REST API, доступное по HTTP.
Требования
Для запуска и работы проекта необходимы:

1. Docker
2. Docker Compose
3. Go 1.24+
Структура проекта
```
├── agent
│   ├── cmd
│   │   └── main.go            // Точка входа в программу агента
│   ├── internal
│   │   └── application.go
│   ├── Dockerfile
│   └── go.mod
├── server
│   ├── cmd
│   │   └── main.go            // Точка входа для оркестратора
│   ├── internal
│   │   ├── application.go
│   │   └── application_test.go
│   ├── models
│   │   ├── expression.go           // Структуры и функции для обработки выражений
│   │   ├── expressionRequest.go    // Модель запроса с выражением
│   │   ├── tasksResultRepository.go
│   │   └── expressionRepository.go
│   ├── Dockerfile
│   ├── go.mod
│   ├── go.sum
│   └── README.md
├── docker-compose.yml
```
Orchestrator 
Принимает HTTP-запросы, содержащие математические выражения.
Распределяет задачи между агентами.
Агрегирует результаты и возвращает их клиенту.

Agent 
Получает задачу от оркестратора (через HTTP).
Выполняет вычисление математического выражения.
Отправляет результат обратно оркестратору.

# Какой flow у  программы ?
Ниже представлена упрощённая схема, показывающая процесс вычисления.

```
                                        ┌──────────────────────┐
                                        │      Клиент (curl)   │
                                        └─────────┬────────────┘
                                                  │ (HTTP)
                                                  ▼
                                        ┌──────────────────────┐
                                        │     Оркестратор      │
                                        │  (Server Container)  │
                                        └─────────┬────────────┘
                                                  │ (Новая задача)
                                                  ▼
                                        ┌──────────────────────┐
                                        │       Задачи         │
                                        │(Task Queue in Server)│
                                        └─────────┬───────────┘
                                                  │ (HTTP GET для задач)
                                                  ▼
                                        ┌──────────────────────┐
                                        │      Агент (Agent)   │
                                        │Agent Containers, n≥1 │
                                        └─────────┬────────────┘
                                                  │ (Результат)
                                                  ▼
                                        ┌──────────────────────┐
                                        │     Оркестратор      │
                                        └─────────┬────────────┘
                                                  │ (HTTP Response)
                                                  ▼
                                        ┌──────────────────────┐
                                        │      Клиент (curl)   │
                                        └──────────────────────┘
```

1. Клиент отправляет запрос с выражением на оркестратор.
2. Оркестратор сохраняет выражение, разбивает его на задачи и помещает в очередь.
3. Агент запрашивает следующую задачу, вычисляет её и отсылает результат обратно.
4. Оркестратор в итоге собирает все результаты и возвращает итоговое значение клиенту.

# Быстрый старт
Склонируйте репозиторий (или загрузите его архивом):
```bash

  git clone https://github.com/Tuma78/server

```
Настройте переменные окружения.

- **Переменные окружения**:  
  - `TIME_ADDITION_MS`, `TIME_SUBTRACTION_MS`, `TIME_MULTIPLICATIONS_MS`, `TIME_DIVISIONS_MS` — искусственные задержки для сложения, вычитания, умножения и деления (в миллисекундах).  
  - `COMPUTING_POWER` — определяет количество параллельных воркеров у агента.  
  - `ORCHESTRATOR_URL` — адрес, по которому агент будет получать задачи. 

```yml
version: "3.8"
services:
  server:
    build:
      context: ./server  
      dockerfile: Dockerfile
    ports:
      - "8083:8080"  
    restart: always
    environment:
      - TIME_ADDITION_MS=100
      - TIME_SUBTRACTION_MS=100
      - TIME_MULTIPLICATIONS_MS=100
      - TIME_DIVISIONS_MS=100
      - COMPUTING_POWER=10

  agent:
    build:
      context: ./agent  
      dockerfile: Dockerfile
    depends_on:
      - server 
    restart: always
    environment:
      - COMPUTING_POWER=10
      - ORCHESTRATOR_URL=http://server:8080
```
    
Соберите и запустите сервисы с помощью Docker Compose:

```bash

docker-compose up --build
```
Данная команда:

- Создаст образы для оркестратора и агента.
- Запустит контейнеры с настройками из `docker-compose.yml`.
- Оркестратор будет доступен на **порт 8083** хоста.

Если нужно остановить:
```bash
docker-compose down

```

## Примеры запросов

Ниже несколько примеров на базе `curl`. Предполагается, что локально оркестратор доступен по адресу `http://localhost:8083`.

### 1. Отправка выражения на вычисление

```bash
curl -X POST \
    -H "Content-Type: application/json" \
    -d '{"expression": "2 + 2"}' \
    http://localhost:8083/api/v1/calculate
```
Ответ (пример):
```json
{
  "id": "b3f4a985-c611-4b6a-899b-5109ed8843ac"
}
```
Полученный `id` — это идентификатор вашей операции.

### 2. Получение статуса и результата выражения
```bash
curl -X GET http://localhost:8083/api/v1/expressions/<expression_id>
```
Если вычисление ещё идёт, результат может быть пустым. Пример ответа:
```json
{
  "expression": {
    "id": "b3f4a985-c611-4b6a-899b-5109ed8843ac",
    "status": "completed",
    "result": 4.0
  }
}
```

### 3. Список всех вычислений

```bash
curl -X GET http://localhost:8083/api/v1/expressions
```
Пример ответа:
```json
{
  "expressions": [
    {
      "id": "b3f4a985-c611-4b6a-899b-5109ed8843ac",
      "status": "completed",
      "result": 4
    },
    {
      "id": "d5b3c207-247f-4dc2-8e58-652d039801f1",
      "status": "processing"
    }
  ]
}
```
###  Для запуска локально, без докера. Запустите используя два терминала.
Запуск оркестратора
```bash
cd server
go run cmd/main.go
```
Запуск агента
```bash
cd agent
export ORCHESTRATOR_URL=http://localhost:8080
export COMPUTING_POWER=10
go run cmd/main.go
```
### Заключение
Golang Web Calculator Service предоставляет гибкую архитектуру для распределённых вычислений.
Наслаждайтесь работой с сервисом и не стесняйтесь вносить свои улучшения!

